<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>äº”è¡Œå‘½ç†æµ‹ç®— | Five Elements Calculator</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Microsoft YaHei',Arial,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;display:flex;justify-content:center;align-items:center;padding:20px}
    .container{background:rgba(255,255,255,.95);border-radius:20px;padding:40px;box-shadow:0 20px 40px rgba(0,0,0,.1);max-width:520px;width:100%;backdrop-filter:blur(10px);position:relative}
    .lang-switcher{position:absolute;top:20px;right:20px;display:flex;gap:5px;background:rgba(255,255,255,.9);padding:5px;border-radius:20px;box-shadow:0 2px 10px rgba(0,0,0,.1)}
    .lang-btn{padding:6px 12px;border:none;background:transparent;cursor:pointer;border-radius:15px;font-size:14px;transition:.2s;color:#666}
    .lang-btn.active{background:linear-gradient(45deg,#667eea,#764ba2);color:#fff}
    h1{text-align:center;color:#4a5568;margin-bottom:20px;font-size:2rem;background:linear-gradient(45deg,#667eea,#764ba2);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
    .sub{color:#64748b;text-align:center;margin-bottom:24px;font-size:.95rem}
    .input-group{margin-bottom:20px}
    label{display:block;margin-bottom:8px;color:#4a5568;font-weight:bold}
    input[type="date"]{width:100%;padding:14px;border:2px solid #e2e8f0;border-radius:10px;background:#f8fafc;font-size:1.05rem;transition:.2s}
    input[type="date"]:focus{outline:none;border-color:#667eea;box-shadow:0 0 15px rgba(102,126,234,.3);transform:translateY(-1px)}
    .calculate-btn{width:100%;padding:14px;background:linear-gradient(45deg,#667eea,#764ba2);color:#fff;border:0;border-radius:10px;font-size:1.1rem;font-weight:bold;cursor:pointer;transition:.2s;margin-bottom:18px}
    .calculate-btn:hover{transform:translateY(-2px);box-shadow:0 10px 20px rgba(102,126,234,.35)}
    .result{margin-top:10px;padding:18px;background:linear-gradient(135deg,#f8fafc,#e2e8f0);border-radius:15px;border-left:5px solid #667eea}
    .element-bar{margin-bottom:16px}
    .element-label{display:flex;justify-content:space-between;margin-bottom:8px;font-weight:bold}
    .progress-bar{height:18px;background:#e2e8f0;border-radius:10px;overflow:hidden}
    .progress-fill{height:100%;border-radius:10px;transition:width 1s ease-in-out;position:relative}
    .progress-fill::after{content:'';position:absolute;inset:0;background:linear-gradient(45deg,rgba(255,255,255,.3) 25%,transparent 25%,transparent 75%,rgba(255,255,255,.3) 75%);background-size:8px 8px;animation:slide 2s linear infinite}
    @keyframes slide{0%{transform:translateX(-8px)}100%{transform:translateX(8px)}}
    .element-é‡‘,.element-Metal{background:linear-gradient(45deg,#ffd700,#ffed4e);color:#b45309}
    .element-æœ¨,.element-Wood{background:linear-gradient(45deg,#22c55e,#4ade80);color:#15803d}
    .element-æ°´,.element-Water{background:linear-gradient(45deg,#3b82f6,#60a5fa);color:#1d4ed8}
    .element-ç«,.element-Fire{background:linear-gradient(45deg,#ef4444,#f87171);color:#dc2626}
    .element-åœŸ,.element-Earth{background:linear-gradient(45deg,#a3a3a3,#d4d4d8);color:#525252}
    .hidden{display:none}
    .fade-in{animation:fadeIn .8s ease-in}
    @keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
    .tip{margin-top:10px;color:#64748b;font-size:.88rem}
    .fortune-text{margin-top:12px;padding:12px;background:rgba(102,126,234,.08);border-radius:10px;color:#4a5568;line-height:1.6}
    .crystal-advice{margin-top:12px;padding:12px;background:rgba(147,51,234,.08);border-radius:10px;color:#4a5568;line-height:1.6}
    .crystal-advice strong{color:#7c3aed}
  </style>
</head>
<body>
  <div class="container">
    <div class="lang-switcher">
      <button class="lang-btn" onclick="switchLang('zh')">ä¸­æ–‡</button>
      <button class="lang-btn active" onclick="switchLang('en')">EN</button>
    </div>

    <h1 class="lang-text" data-zh="ğŸ”® äº”è¡Œå‘½ç†æµ‹ç®—" data-en="ğŸ”® Five Elements Calculator">ğŸ”® Five Elements Calculator</h1>
    <p class="sub lang-text" data-zh="ç®€åŒ–æ¨¡å‹ï¼šä½¿ç”¨å…¬å†å¹´æŸ± + è¿‘ä¼¼æœˆ/æ—¥æŸ±ï¼Œä»…ä¾›å¨±ä¹å‚è€ƒ" data-en="Simplified model: Using solar calendar + approximate calculation, for entertainment only">Simplified model: Using solar calendar + approximate calculation, for entertainment only</p>

    <div class="input-group">
      <label for="birthday" class="lang-text" data-zh="è¯·è¾“å…¥æ‚¨çš„å‡ºç”Ÿæ—¥æœŸï¼š" data-en="Please enter your birth date:">Please enter your birth date:</label>
      <input type="date" id="birthday" required>
    </div>

    <button class="calculate-btn lang-text" onclick="calculateElements()" data-zh="âœ¨ å¼€å§‹æµ‹ç®—äº”è¡Œ" data-en="âœ¨ Calculate Elements">âœ¨ Calculate Elements</button>

    <div id="result" class="result hidden">
      <h3 style="margin-bottom:14px;color:#4a5568;text-align:center;" class="lang-text" data-zh="æ‚¨çš„äº”è¡Œåˆ†å¸ƒ" data-en="Your Five Elements Distribution">Your Five Elements Distribution</h3>

      <div class="element-bar">
        <div class="element-label"><span class="element-name-é‡‘">ğŸ¥‡ Metal</span><span id="é‡‘-percent">0%</span></div>
        <div class="progress-bar"><div class="progress-fill element-é‡‘" id="é‡‘-bar" style="width:0%"></div></div>
      </div>
      <div class="element-bar">
        <div class="element-label"><span class="element-name-æœ¨">ğŸŒ² Wood</span><span id="æœ¨-percent">0%</span></div>
        <div class="progress-bar"><div class="progress-fill element-æœ¨" id="æœ¨-bar" style="width:0%"></div></div>
      </div>
      <div class="element-bar">
        <div class="element-label"><span class="element-name-æ°´">ğŸ’§ Water</span><span id="æ°´-percent">0%</span></div>
        <div class="progress-bar"><div class="progress-fill element-æ°´" id="æ°´-bar" style="width:0%"></div></div>
      </div>
      <div class="element-bar">
        <div class="element-label"><span class="element-name-ç«">ğŸ”¥ Fire</span><span id="ç«-percent">0%</span></div>
        <div class="progress-bar"><div class="progress-fill element-ç«" id="ç«-bar" style="width:0%"></div></div>
      </div>
      <div class="element-bar">
        <div class="element-label"><span class="element-name-åœŸ">ğŸ”ï¸ Earth</span><span id="åœŸ-percent">0%</span></div>
        <div class="progress-bar"><div class="progress-fill element-åœŸ" id="åœŸ-bar" style="width:0%"></div></div>
      </div>

      <div class="tip" id="gz-tip"></div>
      <div class="fortune-text" id="fortune-text"></div>
      <div class="crystal-advice" id="crystal-advice"></div>
    </div>
  </div>

  <script>
    let currentLang = 'en';  // æ”¹ä¸ºé»˜è®¤è‹±æ–‡

    // æ­£ç¡®çš„å¤©å¹²ã€åœ°æ”¯é¡ºåº
    const TIAN_GAN = ['ç”²','ä¹™','ä¸™','ä¸','æˆŠ','å·±','åºš','è¾›','å£¬','ç™¸'];
    const DI_ZHI   = ['å­','ä¸‘','å¯…','å¯','è¾°','å·³','åˆ','æœª','ç”³','é…‰','æˆŒ','äº¥'];

    // äº”è¡Œæ˜ å°„
    const GAN_WX = {'ç”²':'æœ¨','ä¹™':'æœ¨','ä¸™':'ç«','ä¸':'ç«','æˆŠ':'åœŸ','å·±':'åœŸ','åºš':'é‡‘','è¾›':'é‡‘','å£¬':'æ°´','ç™¸':'æ°´'};
    const ZHI_WX = {'å­':'æ°´','ä¸‘':'åœŸ','å¯…':'æœ¨','å¯':'æœ¨','è¾°':'åœŸ','å·³':'ç«','åˆ':'ç«','æœª':'åœŸ','ç”³':'é‡‘','é…‰':'é‡‘','æˆŒ':'åœŸ','äº¥':'æ°´'};

    // å…ƒç´ åç§°æ˜ å°„
    const elementNames = {
      zh: {'é‡‘':'é‡‘', 'æœ¨':'æœ¨', 'æ°´':'æ°´', 'ç«':'ç«', 'åœŸ':'åœŸ'},
      en: {'é‡‘':'Metal', 'æœ¨':'Wood', 'æ°´':'Water', 'ç«':'Fire', 'åœŸ':'Earth'}
    };

    // å¤šè¯­è¨€æ–‡æœ¬
    const texts = {
      zh: {
        'é‡‘': {
          main: 'é‡‘æ—ºï¼šåšæ¯…æœæ–­ã€ç»„ç»‡åŠ›å¼ºï¼Œé€‚åˆç®¡ç†/é‡‘è/æ³•åŠ¡ç­‰å·¥ä½œã€‚',
          lack: 'ç¼ºå°‘çš„å…ƒç´ ï¼š',
          crystal: 'æ°´æ™¶å»ºè®®ï¼š'
        },
        'æœ¨': {
          main: 'æœ¨æ—ºï¼šç”Ÿå‘å‘ä¸Šã€é€‚åº”å¼ºï¼Œé€‚åˆæ•™è‚²/åˆ›æ„/åŒ»ç–—ç­‰å·¥ä½œã€‚',
          lack: 'ç¼ºå°‘çš„å…ƒç´ ï¼š',
          crystal: 'æ°´æ™¶å»ºè®®ï¼š'
        },
        'æ°´': {
          main: 'æ°´æ—ºï¼šæ™ºæ…§çµåŠ¨ã€æ´å¯ŸåŠ›å¼ºï¼Œé€‚åˆç ”ç©¶/å’¨è¯¢/ä¼ æ’­ç­‰å·¥ä½œã€‚',
          lack: 'ç¼ºå°‘çš„å…ƒç´ ï¼š',
          crystal: 'æ°´æ™¶å»ºè®®ï¼š'
        },
        'ç«': {
          main: 'ç«æ—ºï¼šçƒ­æƒ…å¤–å‘ã€æ„ŸæŸ“åŠ›å¼ºï¼Œé€‚åˆé”€å”®/ä¼ åª’/è¡¨æ¼”ç­‰å·¥ä½œã€‚',
          lack: 'ç¼ºå°‘çš„å…ƒç´ ï¼š',
          crystal: 'æ°´æ™¶å»ºè®®ï¼š'
        },
        'åœŸ': {
          main: 'åœŸæ—ºï¼šç¨³é‡å¯é ã€è€å¿ƒè´Ÿè´£ï¼Œé€‚åˆè¿è¥/äººäº‹/æœåŠ¡ç­‰å·¥ä½œã€‚',
          lack: 'ç¼ºå°‘çš„å…ƒç´ ï¼š',
          crystal: 'æ°´æ™¶å»ºè®®ï¼š'
        }
      },
      en: {
        'é‡‘': {
          main: 'Metal dominant: Determined and organized, suitable for management/finance/legal work.',
          lack: 'Lacking elements: ',
          crystal: 'Crystal recommendations: '
        },
        'æœ¨': {
          main: 'Wood dominant: Growing and adaptive, suitable for education/creative/medical work.',
          lack: 'Lacking elements: ',
          crystal: 'Crystal recommendations: '
        },
        'æ°´': {
          main: 'Water dominant: Intelligent and insightful, suitable for research/consulting/communication.',
          lack: 'Lacking elements: ',
          crystal: 'Crystal recommendations: '
        },
        'ç«': {
          main: 'Fire dominant: Enthusiastic and charismatic, suitable for sales/media/performance.',
          lack: 'Lacking elements: ',
          crystal: 'Crystal recommendations: '
        },
        'åœŸ': {
          main: 'Earth dominant: Stable and reliable, suitable for operations/HR/service work.',
          lack: 'Lacking elements: ',
          crystal: 'Crystal recommendations: '
        }
      }
    };

    // æ°´æ™¶å¯¹åº”è¡¨
    const crystalMap = {
      zh: {
        'é‡‘': 'ç™½æ°´æ™¶ã€é’›æ™¶ã€é‡‘å‘æ™¶ã€é“¶å‘æ™¶',
        'æœ¨': 'ç»¿å¹½çµã€ç»¿å‘æ™¶ã€å­”é›€çŸ³ã€ç»¿æ¾çŸ³',
        'æ°´': 'é»‘æ›œçŸ³ã€é»‘å‘æ™¶ã€æµ·è“å®ã€è“æ°´æ™¶',
        'ç«': 'çº¢ç›ç‘™ã€çº¢å‘æ™¶ã€çŸ³æ¦´çŸ³ã€çº¢çº¹çŸ³',
        'åœŸ': 'é»„æ°´æ™¶ã€è™çœ¼çŸ³ã€é»„ç‰ã€ç¥ç€'
      },
      en: {
        'é‡‘': 'Clear Quartz, Rutilated Quartz, Gold Rutile Quartz, Silver Rutile Quartz',
        'æœ¨': 'Green Phantom Quartz, Green Rutile Quartz, Malachite, Turquoise',
        'æ°´': 'Obsidian, Black Rutile Quartz, Aquamarine, Blue Crystal',
        'ç«': 'Red Agate, Red Rutile Quartz, Garnet, Rhodochrosite',
        'åœŸ': 'Citrine, Tiger Eye, Yellow Topaz, Amber'
      }
    };

    function switchLang(lang) {
      currentLang = lang;
      document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      
      // æ›´æ–°æ‰€æœ‰å¸¦æœ‰lang-textç±»çš„å…ƒç´ 
      document.querySelectorAll('.lang-text').forEach(el => {
        el.textContent = el.getAttribute(`data-${lang}`);
      });

      // æ›´æ–°å…ƒç´ åç§°
      ['é‡‘','æœ¨','æ°´','ç«','åœŸ'].forEach(el => {
        const nameEl = document.querySelector(`.element-name-${el}`);
        if(nameEl) {
          const icon = nameEl.textContent.split(' ')[0];
          nameEl.textContent = icon + ' ' + elementNames[lang][el];
        }
      });

      // å¦‚æœæœ‰ç»“æœï¼Œé‡æ–°æ¸²æŸ“
      if(!document.getElementById('result').classList.contains('hidden')) {
        const lastGZ = window.lastGZ;
        const lastPct = window.lastPct;
        if(lastGZ && lastPct) {
          renderText(lastGZ, lastPct);
        }
      }
    }

    // è¿‘ä¼¼ï¼šæŒ‰å…¬å†å¹´æ¨å¹´æŸ±ï¼ˆæœªæŒ‰ç«‹æ˜¥åˆ‡æ¢ï¼Œå¨±ä¹ç”¨ï¼‰
    function getYearGZ(gYear){
      const gan = TIAN_GAN[(gYear - 4) % 10];
      const zhi = DI_ZHI[(gYear - 4) % 12];
      return gan + zhi;
    }

    // è¿‘ä¼¼ï¼šæ„é€ "æœˆ/æ—¥æŸ±"çš„ç´¢å¼•ï¼ˆä»…ä½œå¨±ä¹ï¼Œä¸æ˜¯æ­£ç»Ÿç®—æ³•ï¼‰
    function getPseudoGZ(seed){
      const gan = TIAN_GAN[(seed) % 10];
      const zhi = DI_ZHI[(seed) % 12];
      return gan + zhi;
    }

    function calculateElements(){
      const birthday = document.getElementById('birthday').value;
      if(!birthday){ 
        alert(currentLang === 'zh' ? 'è¯·é€‰æ‹©æ‚¨çš„å‡ºç”Ÿæ—¥æœŸï¼' : 'Please select your birth date!'); 
        return; 
      }

      const d = new Date(birthday + 'T12:00:00'); // é¿å…æ—¶åŒºé›¶ç‚¹åç§»
      const y = d.getFullYear(), m = d.getMonth() + 1, day = d.getDate();

      // å¹´æŸ±ï¼ˆè¿‘ä¼¼ï¼‰
      const yearGZ = getYearGZ(y);
      // æœˆ/æ—¥æŸ±ï¼ˆè¿‘ä¼¼æ¨æ³•ï¼šä»…ä¸ºæœ‰è¶£å±•ç¤ºï¼‰
      const monthGZ = getPseudoGZ(y * 12 + m);
      const dayGZ   = getPseudoGZ(y * 372 + m * 31 + day);

      const gans  = [yearGZ[0], monthGZ[0], dayGZ[0]];
      const zhis  = [yearGZ[1], monthGZ[1], dayGZ[1]];

      const tally = {'é‡‘':0,'æœ¨':0,'æ°´':0,'ç«':0,'åœŸ':0};
      gans.forEach(g => tally[GAN_WX[g]]++);
      zhis.forEach(z => tally[ZHI_WX[z]]++);

      // å­£èŠ‚åŠ æƒï¼ˆå¨±ä¹æ•ˆæœï¼‰
      const season = (m>=3&&m<=5)?'æœ¨':(m>=6&&m<=8)?'ç«':(m>=9&&m<=11)?'é‡‘':'æ°´';
      tally[season] += 1;
      tally['åœŸ']   += Math.floor(day/10); // æ—¥æœŸå¯¹"åœŸ"çš„è½»å¾®åŠ æƒ

      const total = Object.values(tally).reduce((a,b)=>a+b,0);
      const pct = {};
      Object.keys(tally).forEach(k => pct[k] = Math.round(100 * tally[k] / total));
      const sum = Object.values(pct).reduce((a,b)=>a+b,0);
      if(sum !== 100){
        const maxK = Object.keys(pct).reduce((a,b)=>pct[a]>pct[b]?a:b);
        pct[maxK] += (100 - sum);
      }

      // ä¿å­˜ç»“æœä¾›è¯­è¨€åˆ‡æ¢æ—¶ä½¿ç”¨
      window.lastGZ = {yearGZ, monthGZ, dayGZ};
      window.lastPct = pct;

      render({yearGZ, monthGZ, dayGZ}, pct);
    }

    function render(gz, pct){
      const result = document.getElementById('result');
      result.classList.remove('hidden'); 
      result.classList.add('fade-in');

      ['é‡‘','æœ¨','æ°´','ç«','åœŸ'].forEach(k=>{
        document.getElementById(`${k}-percent`).textContent = pct[k] + '%';
        setTimeout(()=>{ document.getElementById(`${k}-bar`).style.width = pct[k]+'%'; }, 200);
      });

      renderText(gz, pct);
    }

    function renderText(gz, pct) {
      // å¹²æ”¯æ˜¾ç¤º
      if(currentLang === 'zh') {
        document.getElementById('gz-tip').innerHTML =
          `å¹´æŸ±ï¼š<b>${gz.yearGZ}</b>ã€€æœˆæŸ±ï¼ˆè¿‘ä¼¼ï¼‰ï¼š<b>${gz.monthGZ}</b>ã€€æ—¥æŸ±ï¼ˆè¿‘ä¼¼ï¼‰ï¼š<b>${gz.dayGZ}</b>`;
      } else {
        document.getElementById('gz-tip').innerHTML =
          `Year Pillar: <b>${gz.yearGZ}</b>ã€€Month Pillar (approx): <b>${gz.monthGZ}</b>ã€€Day Pillar (approx): <b>${gz.dayGZ}</b>`;
      }

      // æ‰¾å‡ºä¸»å¯¼å…ƒç´ å’Œç¼ºå¤±å…ƒç´ 
      const maxEl = Object.keys(pct).reduce((a,b)=> pct[a]>pct[b]?a:b );
      const lackingElements = Object.keys(pct).filter(k => pct[k] <= 10);

      // ä¸»è¦æ€§æ ¼åˆ†æ
      document.getElementById('fortune-text').textContent = texts[currentLang][maxEl].main;

      // æ°´æ™¶å»ºè®®
      let crystalText = '';
      if(lackingElements.length > 0) {
        const lackNames = lackingElements.map(el => elementNames[currentLang][el]).join('ã€');
        crystalText = texts[currentLang][maxEl].lack + lackNames + '<br>';
        
        const crystalSuggestions = lackingElements.map(el => {
          const elName = elementNames[currentLang][el];
          const crystals = crystalMap[currentLang][el];
          return `<strong>${elName}:</strong> ${crystals}`;
        }).join('<br>');
        
        crystalText += texts[currentLang][maxEl].crystal + '<br>' + crystalSuggestions;
      } else {
        if(currentLang === 'zh') {
          crystalText = 'äº”è¡Œè¾ƒä¸ºå‡è¡¡ï¼å¯é€‰æ‹©å¯¹åº”æ‚¨ä¸»å¯¼å…ƒç´ çš„æ°´æ™¶ï¼š<br>' + crystalMap[currentLang][maxEl];
        } else {
          crystalText = 'Your elements are well-balanced! You may choose crystals for your dominant element:<br>' + crystalMap[currentLang][maxEl];
        }
      }
      
      document.getElementById('crystal-advice').innerHTML = crystalText;
    }
  </script>
</body>
</html>
